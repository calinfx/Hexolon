<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Test V2.0</title>
    <style>
        body { margin: 0; background-color: #212121; } /* Dark Mode background */
        button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: #9370DB; /* Purple */
            color: #212121;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px; /* Rounded corners */
        }
        .version-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #9370DB; /* Purple */
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="version-tag">V2.0 - AR Cube</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module">
        import { USDZExporter } from 'https://unpkg.com/three@0.128.0/examples/jsm/exporters/USDZExporter.js';

        // --- Step 1: Create the Scene and Geometry ---
        const scene = new THREE.Scene();
        scene.name = "CubeScene";

        // Material using preferred desert color (brown/orange-ish)
        const desertColor = 0x986640; // Desert Brown/Orange
        const material = new THREE.MeshPhysicalMaterial({
            color: desertColor,
            metalness: 0.1,
            roughness: 0.8,
            flatShading: true
        });

        // Simple Cube Geometry (0.5m x 0.5m x 0.5m)
        const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
        const cube = new THREE.Mesh(geometry, material);
        cube.position.set(0, 0.25, 0); // Lift it onto the floor (Y=0)
        scene.add(cube);

        // --- Step 2: USDZ Export Function ---
        const exporter = new USDZExporter();

        function exportUSDZ() {
            // The exporter generates a binary ArrayBuffer
            exporter.parse(scene).then((result) => {
                const blob = new Blob([result], { type: 'application/octet-stream' });

                // Download the file (this is where the USDZ is created in your browser)
                const link = document.createElement('a');
                link.style.display = 'none';
                document.body.appendChild(link);
                link.href = URL.createObjectURL(blob);
                link.download = 'SimpleCube_V2.usdz';
                link.click();

                document.body.removeChild(link);
                alert("USDZ file downloaded. Host it with HTTPS to use Quick Look AR!");
            });
        }

        // --- Step 3: Add the Button for Mobile ---
        const exportButton = document.createElement('button');
        exportButton.textContent = 'EXPORT USDZ';
        exportButton.onclick = exportUSDZ;
        document.body.appendChild(exportButton);
        
        // --- Optional: Basic WebGL renderer for visual check ---
        const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 10 );
        camera.position.z = 2;
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        function animate() {
            requestAnimationFrame( animate );
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
            renderer.render( scene, camera );
        }
        animate();
    </script>
</body>
</html>
